<main class="lg:max-w-[90%] px-5 py-10 max-sm:py-2 mx-auto">
  <!-- Header -->
  <h1
    class="text-xl text-foreground my-3 capitalize max-sm:block hidden"
    *ngIf="quiz"
  >
    Title: {{ quiz.title }}*
  </h1>
  <div
    class="flex flex-wrap justify-between items-center gap-4 pb-8 border-b border-gray-200 mb-8 max-sm:hidden"
  >
    <div
      class="flex gap-4 flex-col sm:flex-row justify-between items-center w-full"
    >
      <div>
        <h1 class="text-3xl font-bold text-foreground text-center sm:text-left">
          Student Grades
        </h1>
        <p class="text-lg text-muted-foreground mt-2 capitalize" *ngIf="quiz">
          Title: {{ quiz.title }}*
        </p>
      </div>
      <button
        variant="outline"
        hlmBtn
        class="flex items-center gap-2"
        routerLink="/teacher-dashboard"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="22"
          height="22"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="lucide lucide-arrow-big-left-icon lucide-arrow-big-left transition-transform group-hover:-translate-x-1"
        >
          <path
            d="M13 9a1 1 0 0 1-1-1V5.061a1 1 0 0 0-1.811-.75l-6.835 6.836a1.207 1.207 0 0 0 0 1.707l6.835 6.835a1 1 0 0 0 1.811-.75V16a1 1 0 0 1 1-1h6a1 1 0 0 0 1-1v-4a1 1 0 0 0-1-1z"
          />
        </svg>
        <span class="text-base">Back</span>
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <ng-container *ngIf="loading; else studentContent">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <div
        *ngFor="let _ of [1, 2, 3, 4, 5, 6]"
        class="bg-white rounded-lg shadow-md p-6 animate-pulse"
      >
        <div class="flex items-center gap-4 mb-4">
          <div class="w-12 h-12 bg-gray-200 rounded-full"></div>
          <div class="flex-1">
            <div class="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
            <div class="h-3 bg-gray-200 rounded w-1/2"></div>
          </div>
        </div>
        <div class="h-10 bg-gray-200 rounded"></div>
      </div>
    </div>
  </ng-container>

  <!-- Student Grades Content -->
  <ng-template #studentContent>
    <ng-container *ngIf="students && students.length > 0; else noStudents">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Student Grade Card -->
        <div
          *ngFor="let student of students"
          class="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow p-6 border-l-4 min-h-[200px] flex flex-col justify-between"
          [ngClass]="{
            'border-blue-400': student.isGraded,
            'border-warning': student.status === 'grading' && !student.isGraded,
            'border-success': student.status === 'finished' && student.isGraded,
            'border-gray-400': !student.hasSubmission
          }"
        >
          <!-- Student Info -->
          <div class="flex items-center gap-4 mb-4">
            <div
              class="w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-lg"
              [ngClass]="{
                'bg-blue-500': student.isGraded,
                'bg-warning': student.status === 'grading' && !student.isGraded,
                'bg-success': student.status === 'finished' && student.isGraded,
                'bg-gray-400': !student.hasSubmission
              }"
            >
              {{ student.name.charAt(0).toUpperCase() }}
            </div>
            <div class="flex-1">
              <h3 class="font-semibold text-lg text-foreground">
                {{ student.name }}
              </h3>
              <div class="flex items-center gap-2 mt-1">
                <span
                  class="text-xs font-medium px-2 py-1 rounded-full"
                  [ngClass]="
                    getStatusBadgeColor(student.status, student.isGraded)
                  "
                >
                  {{
                    student.isGraded ? "âœ“ Graded" : (student.status | titlecase)
                  }}
                </span>
                <span
                  *ngIf="student.hasSubmission && !student.isGraded"
                  class="text-xs px-2 py-1 bg-green-100 text-green-700 rounded-full font-medium"
                >
                  Submitted
                </span>
                <span
                  *ngIf="!student.hasSubmission"
                  class="text-xs px-2 py-1 bg-orange-100 text-orange-700 rounded-full font-medium"
                >
                  No Submission
                </span>
              </div>
            </div>
          </div>

          <!-- Grade Display -->
          <div class="mb-4" *ngIf="student.isGraded">
            <div class="text-center">
              <div
                class="text-3xl font-bold mb-1"
                [ngClass]="getGradeColor(student.percentage)"
              >
                {{ student.grade }}/{{ student.totalPoints }}
              </div>
              <div
                class="text-lg font-semibold"
                [ngClass]="getGradeColor(student.percentage)"
              >
                {{ student.percentage }}%
              </div>
              <div class="text-sm text-muted-foreground mt-1">
                {{
                  student.percentage! >= 80
                    ? "Excellent"
                    : student.percentage! >= 60
                    ? "Good"
                    : student.percentage! > 0
                    ? "Needs Improvement"
                    : "Failed"
                }}
              </div>
            </div>
          </div>

          <!-- Action Button -->
          <div class="mt-auto">
            <button
              hlmBtn
              [variant]="student.isGraded ? 'outline' : 'default'"
              class="w-full"
              (click)="gradeStudent(student.studentId)"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="mr-2"
              >
                <path d="M9 12l2 2 4-4" />
                <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3" />
                <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3" />
                <path d="M12 3c0 1-1 3-3 3s-3-2-3-3 1-3 3-3 3 2 3 3" />
                <path d="M12 21c0-1 1-3 3-3s3 2 3 3-1 3-3 3-3-2-3-3" />
              </svg>
              {{ student.isGraded ? "Review Grade" : "Grade Quiz" }}
            </button>
          </div>
        </div>
      </div>
    </ng-container>
  </ng-template>

  <!-- No Students State -->
  <ng-template #noStudents>
    <div class="text-center py-16 text-muted-foreground">
      <div
        class="w-24 h-24 mx-auto mb-6 bg-gradient-to-br from-primary-soft to-accent-soft rounded-full flex items-center justify-center"
      >
        <svg
          class="w-12 h-12 text-primary"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"
          />
        </svg>
      </div>
      <h3 class="text-2xl font-bold text-foreground mb-3">No Students Found</h3>
      <p class="text-base max-w-md mx-auto">
        There are no students assigned to this quiz.
      </p>
    </div>
  </ng-template>
</main>
